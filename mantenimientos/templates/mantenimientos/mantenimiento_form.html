{% extends "base.html" %}
{% load static %}
{% now "Y-m-d" as today %}

{% block content_authenticated %}

<div class="container py-4 d-flex justify-content-center">
  <div class="card shadow-sm p-4 form-card">
    
    <h4 class="mb-4 text-center text-dark">
      {% if form.instance.pk %}Editar mantenimiento{% else %}Subir mantenimiento{% endif %}
    </h4>

    {# Errores globales #}
    {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3">
      {{ form.non_field_errors }}
    </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <!-- Fecha -->
      <div class="mb-3">
        {{ form.fecha.label_tag }}
        {{ form.fecha }}
        {% if form.fecha.errors %}
        <div class="text-danger small mt-1">
          {{ form.fecha.errors|striptags }}
        </div>
        {% endif %}
      </div>

      <!-- Cantidad -->
      <div class="mb-3">
        {{ form.cantidad.label_tag }}
        {{ form.cantidad }}
        <div class="form-text">Rango permitido: 0 a 15. La media alta es 7.</div>
        {% if form.cantidad.errors %}
        <div class="text-danger small mt-1">
          {{ form.cantidad.errors|striptags }}
        </div>
        {% endif %}
      </div>

      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>

    </form>

  </div>
</div>

{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
<script>
  flatpickr(".flatpickr", {
    dateFormat: "Y-m-d",
    locale: "es",
    defaultDate: "{% if form.initial.fecha %}{{ form.initial.fecha|date:'Y-m-d' }}{% else %}{{ today }}{% endif %}"
  });
</script>
{% endblock %}
