{% extends "base.html" %}
{% block content_authenticated %}

<div class="container mt-4">
  <h2>Detalle de Venta</h2>

  <div class="card">
    <div class="card-body">

      <p><strong>Usuario:</strong> {{ venta.usuario }}</p>
      <p><strong>Fecha:</strong> {{ venta.fecha|date:"Y-m-d H:i" }}</p>

      <p><strong>Instalación Nº:</strong>
        {% if venta.instalacion_numero %}
          {{ venta.instalacion_numero }}
        {% else %}
          No asignado
        {% endif %}
      </p>

      <p><strong>Mantenimiento Nº:</strong>
        {% if venta.mantenimiento_numero %}
          {{ venta.mantenimiento_numero }}
        {% else %}
          No asignado
        {% endif %}
      </p>

      <p><strong>Convertido en PPA:</strong> {{ venta.ppa|yesno:"Sí,No" }}</p>

      <h5 class="mt-4">Ofertas incluidas</h5>

      {% if venta.venta_ofertas.all %}
        <ul class="list-group mb-3">
          {% for vo in venta.venta_ofertas.all %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ vo.oferta.nombre }}</strong>
                <small class="text-muted">
                  ({{ vo.oferta.referencia.tipo.nombre }} — 0 + {{ vo.oferta.valor }})
                </small>
              </div>
              <span class="badge bg-primary rounded-pill">x{{ vo.cantidad }}</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No hay ofertas asociadas.</p>
      {% endif %}

    </div>

    <div class="card-footer">
      <a href="{% url 'venta_update' venta.pk %}" class="btn btn-primary">Editar</a>
      <a href="{% url 'venta_list' %}" class="btn btn-secondary">Volver</a>
    </div>
  </div>
</div>

{% endblock %}
