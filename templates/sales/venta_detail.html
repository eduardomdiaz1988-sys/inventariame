{% extends "base.html" %}
{% block content_authenticated %}
<div class="container mt-4">
  <h2>Detalle de Venta</h2>
  <div class="card">
    <div class="card-body">
      <p><strong>Usuario:</strong> {{ venta.usuario }}</p>
      <p><strong>Fecha:</strong> {{ venta.fecha|date:"Y-m-d H:i" }}</p>
      <p><strong>Se ha Convertido en PPA:</strong> {{ venta.ppa|yesno:"Sí,No" }}</p>
      <p><strong>Mantenimiento Nº:</strong>
        {% if venta.mantenimiento_numero %}
          {{ venta.mantenimiento_numero }}
        {% else %}
          No asignado
        {% endif %}
      </p>

      <!-- NUEVO BLOQUE: Ofertas asociadas -->
      <h5 class="mt-4">Ofertas incluidas en la venta</h5>
      {% if venta.venta_ofertas.all %}
        <ul class="list-group mb-3">
          {% for vo in venta.venta_ofertas.all %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ vo.oferta.nombre }}</strong>  
                <span class="text-muted">({{ vo.oferta.valor }} €)</span>
              </div>
              <span class="badge bg-primary rounded-pill">x{{ vo.cantidad }}</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No hay ofertas asociadas a esta venta.</p>
      {% endif %}
    </div>
    <div class="card-footer">
      <a href="{% url 'venta_update' venta.pk %}" class="btn btn-primary">Editar</a>
      <a href="{% url 'venta_list' %}" class="btn btn-secondary">Volver al listado</a>
    </div>
  </div>
</div>
{% endblock %}
