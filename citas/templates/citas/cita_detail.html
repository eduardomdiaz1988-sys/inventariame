{% extends "base.html" %}
{% block content_authenticated %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">Detalles de la cita</h2>
  <div class="d-flex gap-2">
    <a href="{% url 'cita_update' cita.pk %}" class="btn btn-outline-primary btn-sm">
      <i class="bi bi-pencil"></i> Editar
    </a>
    <a href="{% url 'cita_delete' cita.pk %}" class="btn btn-outline-danger btn-sm">
      <i class="bi bi-x-lg"></i> Eliminar
    </a>
  </div>
</div>

<div class="card p-3">
  <dl class="row mb-0">

    <!-- CLIENTE -->
    <dt class="col-sm-3">Cliente</dt>
    <dd class="col-sm-9">{{ cita.cliente }}</dd>

    <!-- FECHA -->
    <dt class="col-sm-3">Fecha</dt>
    <dd class="col-sm-9">{{ cita.fecha|date:"Y-m-d H:i" }}</dd>

    <!-- RECORDATORIO -->
    <dt class="col-sm-3">Recordatorio</dt>
    <dd class="col-sm-9">{{ cita.recordatorio|yesno:"Sí,No" }}</dd>

    <!-- OFERTAS -->
    <dt class="col-sm-3">Ofertas</dt>
    <dd class="col-sm-9">
      {% if cita.cita_ofertas.all %}
        <ul class="list-unstyled mb-0">
          {% for co in cita.cita_ofertas.all %}
            <li>
              <strong>{{ co.oferta.nombre }}</strong>
              — {{ co.cantidad }} × {{ co.oferta.valor }} €
            </li>
          {% endfor %}
        </ul>
      {% else %}
        -
      {% endif %}
    </dd>

    <!-- ESTADO -->
    <dt class="col-sm-3">Estado</dt>
    <dd class="col-sm-9">{{ cita.estado }}</dd>

    <!-- NÚMERO DE INSTALACIÓN -->
    <dt class="col-sm-3">Número de instalación</dt>
    <dd class="col-sm-9">{{ cita.numero_instalacion|default:"0" }}</dd>

    <!-- OBSERVACIONES -->
    <dt class="col-sm-3">Observaciones</dt>
    <dd class="col-sm-9">
      {% if cita.observaciones %}
        {{ cita.observaciones|linebreaks }}
      {% else %}
        -
      {% endif %}
    </dd>

  </dl>

  <!-- GOOGLE MAPS -->
  {% if cita.cliente.direccion %}
    <div class="mt-3 text-center">
      <a href="https://www.google.com/maps/search/?api=1&query={{ cita.cliente.direccion.address|urlencode }}"
         target="_blank"
         class="btn btn-success">
        <i class="bi bi-geo-alt"></i> Abrir en Google Maps
      </a>
    </div>
  {% endif %}
</div>

{% endblock %}
